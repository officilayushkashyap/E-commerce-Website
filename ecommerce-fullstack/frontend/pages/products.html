<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Products - ShopHub</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <a href="../index.html"><h1>üõçÔ∏è ShopHub</h1></a>
                </div>
                <nav class="nav" id="mainNav">
                    <a href="../index.html">Home</a>
                    <a href="products.html">Products</a>
                    <a href="cart.html">Cart (<span id="cartCount">0</span>)</a>
                    <div id="authLinks"></div>
                </nav>
            </div>
        </div>
    </header>

    <div class="container" style="padding: 40px 20px;">
        <h1>All Products</h1>
        
        <div class="filters">
            <div class="filter-group">
                <label for="searchInput">Search Products</label>
                <input type="text" id="searchInput" placeholder="Search by name...">
            </div>
            <div class="filter-group">
                <label for="categoryFilter">Category</label>
                <select id="categoryFilter">
                    <option value="">All Categories</option>
                    <option value="Electronics">Electronics</option>
                    <option value="Fashion">Fashion</option>
                    <option value="Home">Home</option>
                    <option value="Sports">Sports</option>
                </select>
            </div>
        </div>

        <div class="product-grid" id="productsGrid">
            <div class="loading">Loading products...</div>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 ShopHub. All rights reserved.</p>
        </div>
    </footer>

    <script src="../js/config.js"></script>
    <script src="../js/auth.js"></script>
    <script src="../js/main.js"></script>
    <script>
        async function loadProducts() {
            const container = document.getElementById('productsGrid');
            const search = document.getElementById('searchInput').value;
            const category = document.getElementById('categoryFilter').value;
            
            let query = '/products?limit=50';
            if (search) query += `&search=${encodeURIComponent(search)}`;
            if (category) query += `&category=${encodeURIComponent(category)}`;
            
            try {
                const data = await apiCall(query);
                
                if (data.data.length === 0) {
                    container.innerHTML = '<div class="empty-state"><h3>No products found</h3></div>';
                    return;
                }
                
                container.innerHTML = data.data.map(product => `
                    <a href="product-detail.html?id=${product._id}" class="product-card">
                        <div class="product-image">üì¶</div>
                        <h3>${product.name}</h3>
                        <p class="product-price">$${product.price.toFixed(2)}</p>
                        <p class="${product.stock > 0 ? 'product-stock' : 'out-of-stock'}">
                            ${product.stock > 0 ? `${product.stock} in stock` : 'Out of stock'}
                        </p>
                    </a>
                `).join('');
            } catch (error) {
                container.innerHTML = `<p class="message-error">Error: ${error.message}</p>`;
            }
        }

        document.getElementById('searchInput').addEventListener('input', () => {
            clearTimeout(window.searchTimeout);
            window.searchTimeout = setTimeout(loadProducts, 500);
        });
        
        document.getElementById('categoryFilter').addEventListener('change', loadProducts);
        
        document.addEventListener('DOMContentLoaded', loadProducts);
    </script>
</body>
</html>
